{% extends 'base.html' %}
  
{% block content %}

<div class="row">
  <div class="col-lg-12 col-lg-offset-0 product-page">

    <h1>{{ product.title }}</h1><br><br>

    {% if "user" in session %}
      {% if is_favorite %}
        <button class="btn btn-default" id="product-fav-button">Favorited</button>
      {% else %}
        <button class="btn btn-default" id="product-fav-button">Add to favorites</button>
      {% endif %}
    {% endif %}
    <br><br>
    
    <!-- # Product image and ratings histogram -->
    <div class="container-fluid">
      <div class="row">
        <div class="col-xs-6">
          <img src={{ product.image }}>
        </div>
        <div class="col-xs-6">
          <h2>Product Ratings</h2>
          <div class="product-histogram">
            <canvas id="barChart"></canvas>
          <div>
        </div>
      </div>
    </div>

    <!-- # Review keywords from naive bayes -->
    <div class="container-fluid">
    <div class="row">
      <div class="col-lg-12">
        <br>
        <h3>People who rated this product positively used these words in their reviews:</h3>
        {% for pk in positive_keywords %}
          {{ pk }},
        {% endfor %} 

        <h3>People who rated this product negatively used these words in their reviews:</h3>

        {% for nk in negative_keywords %}
          {{ nk }}, 
        {% endfor %}
      </div>
    </div>
    </div>

    <!-- # Review search bar -->
    <div class="row">
      <div class="col-md-10 col-md-offset-0">
        <br>
        <h2>Search within reviews:</h2>
        <form class="form-inline" action="/search-review" id="review-search-form" method="GET">
          <div class="form-group">
            <input class="form-control input-lg" name="query" id="query" type="text">
          </div>
          <button type="submit" class="btn btn-primary">Search</button>
        </form>
      </div>
    </div>

    <!-- Review display -->

    <h1>Reviews:</h1>
    <div id="reviews">
      {% for rev in reviews %}
        <h3>{{ rev.summary }}</h3>

        {% if "user" in session %}
          {% if rev.review_id in favorite_reviews %}
            <img src="/static/heart.png" class="heart" height="35" width="35" data-review-id={{ rev.review_id }}>
          {% else %}
            <img src="/static/heart-empty.jpg" class="heart" height="35" width="35" data-review-id={{ rev.review_id }}>
          {% endif %}
        {% endif %}

        <ul>
          <li>Score: {{ rev.score }}</li>
          <li>Helpful rating: {{ rev.helpful_fraction }}</li>
          <li>{{ rev.review }}</li>
        </ul>
      {% endfor %}
    </div>
    
  </div>
</div>

<!-- Javascript links -->

<!-- Pass the product's asin to javascript files -->
<script> var asin = "{{ product.asin }}";</script>
<script src="/static/histogram.js"></script>
<script src="/static/search_reviews.js"></script>
<script src="/static/favorites.js"></script>


{% endblock %}



